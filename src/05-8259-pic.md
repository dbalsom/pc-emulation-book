# Intel 8259 Programmable Interrupt Controller

The Intel 8259 Programmable Interrupt Controller (PIC) is essential for managing hardware interrupts in the IBM PC. It receives interrupt requests from various devices and presents them to the CPU in an organized, prioritized manner.

## Overview

The 8259 PIC handles up to 8 interrupt sources and can be cascaded with additional PICs for more interrupt lines. In the IBM PC, a single 8259A manages all hardware interrupts, providing crucial system functionality.

### Key Features
- **8 Interrupt Inputs**: IR0 through IR7
- **Programmable Priority**: Software-configurable interrupt priorities
- **Interrupt Masking**: Individual interrupt enable/disable control
- **Cascade Support**: Connect multiple PICs for expanded interrupt handling
- **Multiple Modes**: Edge/level triggering, various EOI modes

## IBM PC Interrupt Configuration

| IRQ | Purpose | Device |
|-----|---------|--------|
| IRQ 0 | System Timer | 8253 Timer 0 |
| IRQ 1 | Keyboard | Keyboard Controller |
| IRQ 2 | Cascade (PC/AT) | Second 8259 (AT only) |
| IRQ 3 | Serial Port 2 | COM2 (if present) |
| IRQ 4 | Serial Port 1 | COM1 |
| IRQ 5 | Parallel Port 2 | LPT2 (if present) |
| IRQ 6 | Floppy Disk | Floppy Disk Controller |
| IRQ 7 | Parallel Port 1 | LPT1 |

## Hardware Interface

### I/O Ports
- **0x20**: Command/Status Register
- **0x21**: Data/Mask Register

### Initialization Command Words (ICW)

The 8259 requires initialization through a sequence of ICW commands:

#### ICW1 (Port 0x20)
```
Bit 7-5: A7-A5 of interrupt vector (MCS-80/85 mode)
Bit 4: 1 = ICW1, 0 = OCW
Bit 3: Level Triggered (1) / Edge Triggered (0)
Bit 2: Call Address Interval (1=4 bytes, 0=8 bytes)
Bit 1: Single (1) / Cascade (0)
Bit 0: ICW4 needed (1) / not needed (0)
```

#### ICW2 (Port 0x21)
```
Bits 7-3: T7-T3 of interrupt vector address
Bits 2-0: Reserved in 8086/8088 mode
```

#### ICW3 (Port 0x21) - Cascade Mode Only
Master PIC:
```
Bit 7-0: 1 = slave attached to corresponding IR input
```

Slave PIC:
```
Bits 2-0: Slave identification number
```

#### ICW4 (Port 0x21) - If ICW1 bit 0 = 1
```
Bit 7-5: Reserved (0)
Bit 4: Special Fully Nested Mode (1) / Normal (0)
Bit 3-2: Buffer Mode (00=Non-buffered, 01=Invalid, 10=Master, 11=Slave)
Bit 1: Auto EOI (1) / Normal EOI (0)
Bit 0: 8086/8088 mode (1) / MCS-80/85 mode (0)
```

## Operation Command Words (OCW)

### OCW1 - Interrupt Mask Register (Port 0x21)
```
Bit 7-0: Mask for IR7-IR0 (1=masked, 0=enabled)
```

### OCW2 - EOI Commands (Port 0x20)
```
Bit 7-5: R, SL, EOI bits for EOI commands
Bit 4-3: Must be 0
Bit 2-0: Interrupt level for specific EOI
```

### OCW3 - Status Commands (Port 0x20)
```
Bit 7: Reserved (0)
Bit 6-5: Special mask mode
Bit 4-3: Must be 01
Bit 2: Poll command (1) / no poll (0)
Bit 1-0: Read register (01=IRR, 10=ISR, 11=invalid)
```

## Implementation Priorities

When implementing an 8259 emulator, focus on these areas in order:

1. **Basic Initialization**: Handle ICW sequence correctly
2. **Interrupt Masking**: Implement OCW1 mask register
3. **Priority Resolution**: Basic priority interrupt selection
4. **EOI Commands**: Handle end-of-interrupt processing
5. **Advanced Features**: Special modes and cascade support

The 8259 PIC is fundamental to IBM PC interrupt handling and must be implemented accurately for proper system operation and software compatibility.
